<!-- Only include in production -->
{% if jekyll.environment == 'production' %}

<!-- Add google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics.id }}"></script>

<script>
    // Reads the value of a cookie by name or returns empty string
    function getCookie(name) {
        var b = document.cookie.match('(^|[^;]+)\\s*' + name + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }

    // Actually starting analytics up
    function addAnalytics() {
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics.id }}');
    }

    // Reading "cookieconsent_status" cookie
    const cookieConsent = getCookie('cookieconsent_status');

    // Start analytics if user consented or did not deny
    if (cookieConsent === 'allow' || cookieConsent === '') {
        addAnalytics();
    }

    // Initialise cookie consent banner
    window.cookieconsent.initialise({
        "palette": {
            "popup": {
                "background": "#efefef",
                "text": "#404040"
            },
            "button": {
                "background": "#8ec760",
                "text": "#ffffff"
            }
        },
        "type": "opt-out",
        "content": {
            "allow": "Approve",
            "dismiss": "Approve",
            "deny": "Reject"
        },
        // Reload the page on user choice to make sure cookie is set
        onStatusChange: function (status, chosenBefore) {
            location.reload();
        }
    })

</script>

{% endif %}